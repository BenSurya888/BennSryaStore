{% extends 'store/base.html' %}
{% load static %}
{% block title %}Home - BennSrya{% endblock %}

{% block content %}
<section class="hero">
  <div class="swiper hero-slider">
    <div class="swiper-wrapper">
      <div class="swiper-slide">
        <img src="{% static 'store/img/banner1.png' %}" alt="Banner 1">
      </div>
      <div class="swiper-slide">
        <img src="{% static 'store/img/banner2.png' %}" alt="Banner 2">
      </div>
    </div>

    <!-- Navigasi -->
    <div class="swiper-button-prev"></div>
    <div class="swiper-button-next"></div>

    <!-- Dots -->
    <div class="swiper-pagination"></div>
  </div>
</section>

<div class="category-nav container">
  {% for category in products_by_category.keys %}
    <button class="category-nav-btn" onclick="scrollToCategory('{{ category }}')">
      {{ category|title }}
    </button>
  {% endfor %}
</div>

{% for category, product_list in products_by_category.items %}
<section class="category-section" id="category-{{ category }}">
  <h2 class="category-title">{{ category|title }}</h2>
  <div class="product-carousel" id="carousel-{{ category }}">
    {% for product in product_list %}
      <article class="card" data-category="{{ product.category }}">
        <a href="{% url 'bensryaa:product_detail' product.id %}">
          <div class="card-image-container">
            <img src="{{ product.logo_url }}" alt="{{ product.brand }}" loading="lazy">
            <div class="card-overlay"></div>
          </div>
          <div class="meta">
            <h3>{{ product.brand }}</h3>
          </div>
        </a>
      </article>
    {% endfor %}
  </div>
  {% if product_list|length > 6 %}
  <div class="load-more-wrapper">
    <button class="load-more-btn" data-category="{{ category }}">
      <span>⬇️</span> Load More {{ category|title }}
    </button>
  </div>
  {% endif %}
</section>
{% endfor %}

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script>
 var swiper = new Swiper(".hero-slider", {
    loop: true,
    slidesPerView: 1,
    centeredSlides: true,
    spaceBetween: 0,
    autoplay: {
      delay: 4000,
      disableOnInteraction: false,
    },
    navigation: {
      nextEl: ".swiper-button-next",
      prevEl: ".swiper-button-prev",
    },
    pagination: {
      el: ".swiper-pagination",
      clickable: true,
    },
  });

// Scroll to category function
function scrollToCategory(category) {
  const element = document.getElementById('category-' + category);
  if (element) {
    element.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }
}

// Load more functionality
document.querySelectorAll('.category-section').forEach(section => {
  const category = section.id.replace('category-', '');
  const cards = section.querySelectorAll('.card');
  const loadMoreBtn = section.querySelector('.load-more-btn');
  
  if (!loadMoreBtn) return;
  
  let visibleCount = 7;
  
  // Initial show
  showCards();
  
  loadMoreBtn.addEventListener('click', () => {
    visibleCount += 7;
    showCards();
    
    // Smooth scroll to the newly shown cards
    if (visibleCount < cards.length) {
      cards[visibleCount - 1].scrollIntoView({ 
        behavior: 'smooth', 
        block: 'nearest',
        inline: 'start'
      });
    }
  });
  
  function showCards() {
    cards.forEach((card, i) => {
      card.style.display = i < visibleCount ? "block" : "none";
    });
    
    if (visibleCount >= cards.length) {
      loadMoreBtn.style.display = "none";
    }
  }
});

// Add intersection observer for animations
document.addEventListener('DOMContentLoaded', function() {
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.style.animationPlayState = 'running';
        observer.unobserve(entry.target);
      }
    });
  }, { threshold: 0.1 });
  
  // Observe category sections
  document.querySelectorAll('.category-section').forEach(section => {
    observer.observe(section);
  });
  
  // Observe cards
  document.querySelectorAll('.card').forEach(card => {
    observer.observe(card);
  });
});
</script>
{% endblock %}