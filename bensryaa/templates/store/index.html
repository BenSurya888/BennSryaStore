{% extends 'store/base.html' %}
{% load static %}
{% block title %}Home - BennSrya{% endblock %}

{% block content %}
<!-- Hero Banner Section -->
<section class="hero-section py-4">
  <div class="swiper hero-slider">
    <div class="swiper-wrapper">
      <div class="swiper-slide">
        <img src="{% static 'store/img/banner1.png' %}" alt="Banner 1" class="w-100">
      </div>
      <div class="swiper-slide">
        <img src="{% static 'store/img/banner2.png' %}" alt="Banner 2" class="w-100">
      </div>
    </div>
    <div class="swiper-button-prev"></div>
    <div class="swiper-button-next"></div>
    <div class="swiper-pagination"></div>
  </div>
</section>

<!-- Category Navigation -->
<div class="container mb-4">
  <div class="d-flex flex-wrap gap-2 justify-content-center">
    {% for category in products_by_category.keys %}
      <button class="btn btn-outline-primary btn-sm" onclick="scrollToCategory('{{ category }}')">
        <i class="fas fa-tag me-1"></i> {{ category|title }}
      </button>
    {% endfor %}
  </div>
</div>

<!-- Products by Category -->
{% for category, product_list in products_by_category.items %}
<section class="category-section mb-5" id="category-{{ category }}">
  <div class="container">
    <div class="d-flex align-items-center justify-content-between mb-4">
      <h2 class="h3 fw-bold mb-0">
        <span class="text-gradient">{{ category|title }}</span>
      </h2>
      <span class="badge bg-primary">{{ product_list|length }} Produk</span>
    </div>
    
    <div class="row g-3 g-md-4 product-grid" id="carousel-{{ category }}">
      {% for product in product_list %}
        <div class="col-6 col-md-4 col-lg-3 col-xl-2 product-item" data-category="{{ product.category }}">
          <div class="card product-card h-100">
            <a href="{% url 'bensryaa:product_detail' product.id %}" class="text-decoration-none">
              <img src="{{ product.logo_url }}" class="card-img-top" alt="{{ product.brand }}" loading="lazy">
              <div class="card-body text-center">
                <h6 class="card-title mb-0">{{ product.brand }}</h6>
              </div>
            </a>
          </div>
        </div>
      {% endfor %}
    </div>
    
    {% if product_list|length > 6 %}
    <div class="text-center mt-4">
      <button class="btn btn-primary btn-lg load-more-btn" data-category="{{ category }}">
        <i class="fas fa-chevron-down me-2"></i> Muat Lebih Banyak {{ category|title }}
      </button>
    </div>
    {% endif %}
  </div>
</section>
{% endfor %}

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script>
 var swiper = new Swiper(".hero-slider", {
    loop: true,
    slidesPerView: 1,
    centeredSlides: true,
    spaceBetween: 0,
    autoplay: {
      delay: 4000,
      disableOnInteraction: false,
    },
    navigation: {
      nextEl: ".swiper-button-next",
      prevEl: ".swiper-button-prev",
    },
    pagination: {
      el: ".swiper-pagination",
      clickable: true,
    },
  });

// Scroll to category function
function scrollToCategory(category) {
  const element = document.getElementById('category-' + category);
  if (element) {
    element.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }
}

// Load more functionality with Bootstrap
document.querySelectorAll('.category-section').forEach(section => {
  const category = section.id.replace('category-', '');
  const productItems = section.querySelectorAll('.product-item');
  const loadMoreBtn = section.querySelector('.load-more-btn');
  
  if (!loadMoreBtn) return;
  
  let visibleCount = 6; // Show 6 items initially on desktop, all on mobile
  
  // Check if mobile
  const isMobile = window.innerWidth < 768;
  if (isMobile) {
    visibleCount = 12; // Show more on mobile initially
  }
  
  // Initial show
  showItems();
  
  loadMoreBtn.addEventListener('click', () => {
    visibleCount += 6;
    showItems();
    
    // Add loading animation
    loadMoreBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Memuat...';
    
    setTimeout(() => {
      loadMoreBtn.innerHTML = '<i class="fas fa-chevron-down me-2"></i> Muat Lebih Banyak ' + category.charAt(0).toUpperCase() + category.slice(1);
      
      // Smooth scroll
      if (visibleCount < productItems.length) {
        productItems[visibleCount - 1].scrollIntoView({ 
          behavior: 'smooth', 
          block: 'nearest'
        });
      }
    }, 300);
  });
  
  function showItems() {
    productItems.forEach((item, i) => {
      if (i < visibleCount) {
        item.style.display = "";
        item.classList.add('fade-in');
      } else {
        item.style.display = "none";
      }
    });
    
    if (visibleCount >= productItems.length) {
      loadMoreBtn.style.display = "none";
    }
  }
  
  // Update visible count on resize
  window.addEventListener('resize', () => {
    const nowMobile = window.innerWidth < 768;
    if (nowMobile !== isMobile) {
      location.reload(); // Simple reload on breakpoint change
    }
  });
});
</script>
{% endblock %}