{% extends 'store/base.html' %}
{% load static %}

{% block title %}{{ object.title }} - BennSrya Store{% endblock %}

{% block content %}
<div class="container product-detail">
  <div class="product-layout">
    
    <!-- Gambar Produk -->
    <div class="product-image">
      {% if object.cover %}
        <img src="{{ object.cover.url }}" alt="{{ object.title }}">
      {% else %}
        <img src="{% static 'store/img/no-image.png' %}" alt="No Image">
      {% endif %}
    </div>

    <!-- Info Produk -->
    <div class="product-info">
      <h1 class="text-glow">{{ object.title }}</h1>
      <p class="description">{{ object.description }}</p>

      <!-- Pilihan Varian (Card) -->
      {% if object.variants.all %}
      <div class="variant-card-grid">
        {% for v in object.variants.all %}
        <div class="variant-card" data-id="{{ v.id }}" data-price="{{ v.price }}">
          <h3>{{ v.name }}</h3>
          <p class="variant-price">Rp {{ v.price }}</p>
        </div>
        {% endfor %}
      </div>
      {% endif %}

      <!-- Form Checkout -->
      <form method="post" action="{% url 'bensryaa:create_order' slug=object.slug %}" class="checkout-form">
        {% csrf_token %}
        <input type="hidden" name="variant" id="variant-id" value="{% if object.variants.first %}{{ object.variants.first.id }}{% endif %}">

        <!-- Input Tambahan -->
        {% if object.extra_input_type == "game_id_server" %}
          <div class="form-group">
            <label for="game_user_id">User ID</label>
            <input type="text" id="game_user_id" name="game_user_id" required>
          </div>
          <div class="form-group">
            <label for="server_id">Server ID</label>
            <input type="text" id="server_id" name="server_id" required>
          </div>
        {% elif object.extra_input_type == "phone_number" %}
          <div class="form-group">
            <label for="phone_number">Nomor HP</label>
            <input type="text" id="phone_number" name="phone_number" required>
          </div>
        {% elif object.extra_input_type == "email" %}
          <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" required>
          </div>
        {% elif object.extra_input_type == "custom" %}
          <div class="form-group">
            <label for="custom_input">{{ object.extra_input_label|default:"Masukkan Data" }}</label>
            <input type="text" id="custom_input" name="custom_input" required>
          </div>
        {% endif %}

        <!-- Pilih Pembayaran -->
        <div class="form-group">
          <label for="payment_method">Metode Pembayaran</label>
          <select id="payment_method" name="payment_method" required>
            <option value="manual">Manual Transfer</option>
            <option value="midtrans">Midtrans</option>
          </select>
        </div>

        <!-- Harga -->
        <p class="price text-glow" id="price-text">
          Rp {% if object.variants.first %}{{ object.variants.first.price }}{% else %}{{ object.price }}{% endif %}
        </p>

        <!-- Tombol -->
        <button type="submit" class="filter-btn">Beli Sekarang</button>
        <a href="{% url 'bensryaa:check_order' %}?ref_id={{ object.ref_id }}" class="filter-btn">Cek Status</a>
      </form>
    </div>
  </div>
</div>

<!-- Script Update Harga -->
<script>
document.addEventListener("DOMContentLoaded", function() {
  const variantCards = document.querySelectorAll(".variant-card");
  const priceText = document.getElementById("price-text");
  const variantIdInput = document.getElementById("variant-id");

  variantCards.forEach(card => {
    card.addEventListener("click", function() {
      variantCards.forEach(c => c.classList.remove("active"));
      this.classList.add("active");

      priceText.textContent = "Rp " + this.dataset.price;
      variantIdInput.value = this.dataset.id;
    });
  });

  // Set default active
  if (variantCards.length > 0) {
    variantCards[0].classList.add("active");
  }
});
</script>
{% endblock %}
